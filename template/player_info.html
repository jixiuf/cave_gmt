{% extends base.html %}
{% block css%}
<link href="../static/dist/player_info.css" rel="stylesheet" type="text/css"/>
<link href="../static/dist/block_list.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="../static/javascript/plugin/any_time/any_time.css">
{% end %}
{% block body %}
<div class="ui-info-option">
    <h2 class="form-signin-heading ui-info-title">玩家信息</h2>
    {% if not isBanned %}
    <button type="button" class="btn btn-default op-ban " id='btn-ban'>封号</button>
    {%else%}
    <button type="button" class="btn btn-default op-unban " id='btn-unban'>解封</button>
    {% end %}
    {% if not isBannedUUID %}
    <button type="button" class="btn btn-default op-ban-uuid " id='btn-ban-uuid'>封设备</button>
    {%else%}
    <button type="button" class="btn btn-default op-unban" id='btn-unban-uuid'>解封设备</button>
    {% end %}

    <button type="button" class="btn btn-default op-kick " id='btn-kick'>踢人</button>
    <button type="button" class="btn btn-default op-del " id='btn-del'>删号</button>
    <a class="btn btn-default"  href="/pay_order/list?where=uin%3D{{ userAttr.uin  }}">定单列表</a>

    <ul class=" list-unstyled ui-content-lists">
        {% if user != None %}
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">PlayerID:</span>
            <span class="ui-items-cell col-sm-9">{{ user.uin  }} </span>
            <input type="hidden" id='uin' value='{{ user.uin  }}' >
            <input type="hidden" id='uuid' value='{{ user.uuid  }}' >
            <input type="hidden" id='accountId' value='{{ user.accountId  }}' >
            <input type="hidden" id='server' value='{{ user.server  }}' >
        </li>
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">PlayerSID:</span>
            <span class="ui-items-cell col-sm-9">{{ user.suin}} </span>
        </li>
        {% end %}

        {% if userAttr != None %}
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">昵称:</span>
            <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " readonly="readonly"  id="op-nickname" value="{{userAttr.nickName}}"> </span>
        </li>
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">性别:</span>
            {% if userAttr.gender == 0 %}
            <span class="ui-items-cell col-sm-9">男 </span>
            {% else %}
            <span class="ui-items-cell col-sm-9">女 </span>
            {% end %}
        </li>
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">个性签名:</span>
            <span class="ui-items-cell col-sm-9"><input type="text" class="form-control " readonly="readonly" id="op-desc" value="{{userAttr.desc}}"> </span>
        </li>

        {% end %}
        {% if user != None %}
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">账号:</span>
            <span class="ui-items-cell col-sm-9">{{ user.accountId  }} </span>
        </li>
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">账号类型:</span>

            {% if user.accountType == 1 %}
            <span class="ui-items-cell col-sm-9">AI</span>
            {%else %}
            <span class="ui-items-cell col-sm-9">普通</span>
            {% end %}
        </li>

        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">服务器:</span>
            <span class="ui-items-cell col-sm-9">{{ user.server  }} </span>
        </li>
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">渠道:</span>
            <span class="ui-items-cell col-sm-9">{{ channelMap.get(str(user.channel))  }} </span>
        </li>
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">设备号:</span>
            <span class="ui-items-cell col-sm-9">{{ user.uuid  }} </span>
        </li>
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">系统:</span>
            {% if user.os == 1 %}
            <span class="ui-items-cell col-sm-9">IOS</span>
            {% elif user.os==2 %}
            <span class="ui-items-cell col-sm-9">Android</span>
            {% elif user.os==3 %}
            <span class="ui-items-cell col-sm-9">windows</span>
            {% elif user.os==13 %}
            <span class="ui-items-cell col-sm-9">WP8</span>
            {% else %}
            <span class="ui-items-cell col-sm-9">未知</span>
            {% end %}
        </li>
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">创建时间</span>
            <span class="ui-items-cell col-sm-9">{{ user.createTime  }} </span>
        </li>
        <li class="clearfix ui-lists-item">
            <span class="ui-items-cell col-sm-2">最近登录时间</span>
            <span class="ui-items-cell col-sm-9">{{ userAttr.lastLoginTime  }} </span>
        </li>
        {% end %}
    </ul>

    {% if money!= None %}
    <ul class=" list-unstyled ui-content-lists">
        <h3 class="">资产信息</h2>
            <li class="clearfix ui-lists-item">
                <span class="ui-items-cell col-sm-2 control-label">金币:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " readonly="readonly" id="op-gold" value="{{money.gold}}"> </span>

                <span class="ui-items-cell col-sm-2 control-label">钻石:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " readonly="readonly" id="op-gem" value="{{money.gem}}"> </span>
            </li>

            <li class="clearfix ui-lists-item">
                <span class="ui-items-cell col-sm-2 control-label">vip值:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " readonly="readonly" id="op-vipValue" value="{{money.vipValue}}"> </span>
                <span class="ui-items-cell col-sm-2 control-label">vip过期时间:</span>
                {% if (money==None or money.lastPayTime==None) %}
                <span class="ui-items-cell col-sm-2">已过期</span>
                {%elif  (money.lastPayTime+datetime.timedelta(days=30)-datetime.datetime.now()).days>0 %}
                <span class="ui-items-cell col-sm-2">剩余{{ (money.lastPayTime+datetime.timedelta(days=30)-datetime.datetime.now()).days }}天</span>
                {%else%}
                <span class="ui-items-cell col-sm-2">未知</span>
                {%end%}
            </li>
            <li class="clearfix ui-lists-item">
                <span class="ui-items-cell col-sm-2 control-label">最近支付时间:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " readonly="readonly" id="op-last-PayTime" value="{{money.lastPayTime}}"> </span>
            </li>

            <li class="clearfix ui-lists-item">
                <span class="ui-items-cell col-sm-2 control-label">表:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " id="op-watch" readonly="readonly"  value="{{money.watch}}"> </span>

                <span class="ui-items-cell col-sm-2 control-label">车:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " id="op-car" readonly="readonly" value="{{money.car}}"> </span>
            </li>
            <li class="clearfix ui-lists-item">
                <span class="ui-items-cell col-sm-2 control-label">房:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " id="op-house" readonly="readonly" value="{{money.house}}"> </span>

                <span class="ui-items-cell col-sm-2 control-label">船:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " id="op-boat" readonly="readonly" value="{{money.boat}}"> </span>
            </li>


            <li class="clearfix ui-lists-item">
                <span class="ui-items-cell col-sm-2 control-label">小喇叭:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " id="op-speaker" readonly="readonly" value="{{money.speaker}}"> </span>

                <span class="ui-items-cell col-sm-2 control-label">踢人卡:</span>
                <span class="ui-items-cell col-sm-2"><input type="text" class="form-control " id="op-kickCard" readonly="readonly" value="{{money.kickCard}}"> </span>
            </li>

            <div class="ui-sumbit">
                <button type="submit" class="btn btn-default op-edit ui-sumbit" >编辑</button>
                <button type="submit" class="btn btn-default op-submit ui-sumbit" >保存</button>
            </div>
    </ul>


    <h5 class="form-signin-heading ui-desk-title">查询玩家资产流水</h5>
    <ul class="">
        <label class="col-sm-2 control-label">选择时间:</label>
        <div class="col-sm-2">
            <input class="form-control op-time-start" type="text" id="timeId">
        </div>
        <button type="submit" class="btn btn-default op-query-assets-log ui-sumbit" >查询</button>
    </ul>

    {% end %}
</div>
<script type="text/javascript" src="../static/javascript/plugin/any_time/any_time.js"></script>
<script type="text/javascript">
 var dateFormat = "%Y-%m-%d";
 $("#timeId").AnyTime_picker({format:dateFormat});

 var uinEl         = $('#uin');
 var uuidEl        = $('#uuid');
 var serverEl      = $('#server');
 var goldEl        = $('#op-gold');
 var gemEl         = $('#op-gem');
 var vipValueEl    = $('#op-vipValue');
 var carEl         = $('#op-car');
 var watchEl       = $('#op-watch');
 var houseEl       = $('#op-house');
 var boatEl        = $('#op-boat');
 var speakerEl     = $('#op-speaker');
 var kickCardEl    = $('#op-kickCard');
 var submitEl      = $('.op-submit');
 var editEl        = $('.op-edit');
 var banEl         =$("#btn-ban");
 var unbanEl       =$("#btn-unban");
 var unbanUUIDEl   =$("#btn-unban-uuid");

 var lastPayTimeEl =$("#op-last-PayTime");
 var btnKickEl     =$("#btn-kick");
 var btnBanUUIDEl  =$("#btn-ban-uuid");

 var nickNameEl    =$("#op-nickname");
 var descEl        =$("#op-desc");
 var delEl         =$("#btn-del");
 var accountIdEl   =$("#accountId");

 var btnQueryAssetsLogEl=$(".op-query-assets-log");

 editEl.on('click', function(){
     if(goldEl.attr("readonly")=="readonly"){
         descEl.removeAttr("readonly");
         nickNameEl.removeAttr("readonly");

         goldEl.removeAttr("readonly");
         gemEl.removeAttr("readonly");
         vipValueEl.removeAttr("readonly");
         carEl.removeAttr("readonly");
         watchEl.removeAttr("readonly");
         houseEl.removeAttr("readonly");
         boatEl.removeAttr("readonly");
         speakerEl.removeAttr("readonly");
         kickCardEl.removeAttr("readonly");
         lastPayTimeEl.removeAttr("readonly");
     }else{
         nickNameEl.attr("readonly","readonly");
         descEl.attr("readonly","readonly");
         goldEl.attr("readonly","readonly");
         gemEl.attr("readonly","readonly");
         vipValueEl.attr("readonly","readonly");
         carEl.attr("readonly","readonly");
         watchEl.attr("readonly","readonly");
         houseEl.attr("readonly","readonly");
         boatEl.attr("readonly","readonly");
         speakerEl.attr("readonly","readonly");
         kickCardEl.attr("readonly","readonly");
         lastPayTimeEl.attr("readonly","readonly");
     }

     /* 　$('input').attr("readonly","readonly")//将input元素设置为readonly
      * 　　$('input').removeAttr("readonly");//去除input元素的readonly属性
      * 　　 if($('input').attr("readonly")==true)//判断input元素是否已经设置了readonly属性     */
 });

 submitEl.on('click', function(){
     var data={};
     data['uin'] = uinEl.val();

     data['gold'] =goldEl.val();
     data['gem'] =gemEl.val();
     data['vipValue'] =vipValueEl.val();
     data['lastPayTime'] =lastPayTimeEl.val();
     data['car'] =carEl.val();
     data['watch'] =watchEl.val();
     data['house'] =houseEl.val();
     data['boat'] =boatEl.val();
     data['speaker'] =speakerEl.val();
     data['kickCard'] =kickCardEl.val();
     data['server']=serverEl.val();
     data['nickName']=nickNameEl.val();
     data['desc']=descEl.val();
     ajaxing = true;
     $.ajax({
         url: '/api/player_info_update',
         type: 'post',
         data: data
     })
      .done(function(data) {
          ajaxing = false;
          if(data!="success"){
              alert(data);
          }
          window.location.reload();
      });
     return false;

 });
 banEl.on('click',function(){
     var data={};
     data['uin'] = uinEl.val();
     ajaxing = true;
     $.ajax({
         url: '/api/player_ban',
         type: 'post',
         data: data
     })
      .done(function(data) {
          ajaxing = false;
          if(data!="success"){
              alert(data);
          }
          window.location.reload();
      });
     return false;


 });
 btnBanUUIDEl.on('click',function(){
     var data={};
     data['uuid'] = uuidEl.val();
     ajaxing = true;
     $.ajax({
         url: '/api/player_ban_uuid',
         type: 'post',
         data: data
     })
      .done(function(data) {
          ajaxing = false;
          if(data!="success"){
              alert(data);
          }
          window.location.reload();
      });
     return false;


 });

 unbanEl.on('click',function(){
     var data={};
     data['uin'] = uinEl.val();
     ajaxing = true;
     $.ajax({
         url: '/api/player_unban',
         type: 'post',
         data: data
     })
      .done(function(data) {
          ajaxing = false;
          if(data!="success"){
              alert(data);
          }
          window.location.reload();
      });
     return false;
 });
 unbanUUIDEl.on('click',function(){
     var data={};
     data['uin'] = uuidEl.val();
     ajaxing = true;
     $.ajax({
         url: '/api/player_unban',
         type: 'post',
         data: data
     })
      .done(function(data) {
          ajaxing = false;
          if(data!="success"){
              alert(data);
          }
          window.location.reload();
      });
     return false;
 });

btnKickEl.on('click',function(){
     var data={};
     data['uin'] = uinEl.val();
     data['serverId'] = serverEl.val();
     data['processId'] = '0';
     ajaxing = true;
     $.ajax({
         url: '/player/kick',
         type: 'post',
         data: data
     })
      .done(function(data) {
          ajaxing = false;
          if(data!="success"){
              alert(data);
          }
          window.location.reload();
      });
     return false;
 });
delEl.on('click',function(){
     var data={};
     data['uin'] = uinEl.val();
     data['accountId'] = accountIdEl.val();
     ajaxing = true;
     $.ajax({
         url: '/player/del',
         type: 'post',
         data: data
     })
      .done(function(data) {
          ajaxing = false;
          if(data!="success"){
              alert(data);
          }
          window.location.reload();
      });
     return false;
 });

btnQueryAssetsLogEl.on('click',function(){
     time=  $("#timeId").val();
     if(time==""){
         alert("请选择时间");
         return false;
     }
     uin = uinEl.val();
     location.href = '/assets_log/list?uin='+uin+"&time="+time;
 });




</script>

{% end %}
