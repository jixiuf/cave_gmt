{% extends base.html %}
{% block css%}
<link href="../static/dist/maintain.css" rel="stylesheet" type="text/css"/>
{% end %}
{% block body %}
<div class="ui-login-form">
    <h2 class="form-signin-heading ui-login-title">紧急公告</h2>
    <form class="form-horizontal" role="form">
        <div class="form-group">
            <label class="col-sm-2 control-label">服务器编号</label>

            <div class="col-sm-6">
                <select class="form-control op-serverid col-sm-2" >
                    <option value='1'>下拉选择serverId(default 1)</option>
                    {% for serverId in serverIdList %}
                    <option value='{{serverId}}'>{{ serverId }}</option>
                    {% end %}
                </select>

            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">紧急公告内容:</label>
            <div class="col-sm-10">
                <div id="sample">
                    <div>
                        <textarea id="editor_id" name="content" style="width:700px;height:300px;"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="submit" class="btn btn-default op-login-submit">发送</button>
            </div>
        </div>
    </form>
</div>

<script type="text/javascript">
 var ajaxing = false,
     serverIdEl = $('.op-serverid'),
     contentEl = $('#editor_id'),
     submitEl = $('.op-login-submit'),
     data = {};

 submitEl.on('click', function() {
     if(ajaxing) return false;
     var serverId = serverIdEl.val().replace(/(^\s*)|(\s*$)/g, ""),
         content = contentEl.val().replace(/(^\s*)|(\s*$)/g, "");
     if(serverId == '' ) {
         serverId="1";
     }
     data['serverId'] = serverId;
     data['content'] = content;
     ajaxing = true;
     $.ajax({
         url: '/broadcast/post',
         type: 'post',
         data: data
     })
      .done(function(data) {
          ajaxing = false;
          if(data == 'success') {
              location.href = '/broadcast/get';
          } else {
              alert('无权限'+data);
          }
      });
     return false;
 });

</script>

{% end %}
